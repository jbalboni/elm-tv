<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>elm-tv</title>
  <link href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet" type="text/css" />
  <link href="//cdn.muicss.com/mui-0.6.0/css/mui.min.css" rel="stylesheet" type="text/css" />
  <style>
      body {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial;
        background-color: #F4F4F4;
      }
    </style>
</head>
<body>
  <script src="//cdn.muicss.com/mui-0.6.0/js/mui.min.js"></script>
  <script src="elm.js"></script>
  <script>
    var app = Elm.Main.fullscreen();
    window.app = app;

    app.ports.saveShow.subscribe(function(show) {
      var shows = localStorage.shows;
      var showArray;
      if (shows) {
        showArray = JSON.parse(shows);
      } else {
        showArray = [];
      }

      showArray.push(show);
      localStorage.setItem('shows', JSON.stringify(showArray));
    });

    app.ports.updateWatchedEpisode.subscribe(function(show) {
      var shows = JSON.parse(localStorage.shows);
      shows.forEach(function(oldShow) {
          if (oldShow.id === show.id) {
              oldShow.lastEpisodeWatched = show.lastEpisodeWatched;
          }
      })

      localStorage.setItem('shows', JSON.stringify(shows));
    });

    if (localStorage.shows) {
      setTimeout(function() {
        app.ports.loadShows.send(JSON.parse(localStorage.shows));
      }, 0);
    }
  </script>
</body>
</html>
